// js/graficoPizzaCustos.js
// ... (Conteúdo completo do graficoPizzaCustos.js fornecido na mensagem anterior)
import { formatCurrency, parseCurrency } from './utils.js'; // parseCurrency adicionado
let chartPizzaCustosInstance = null;
export function initGraficoPizzaCustos() { /* ... */ }
export function destroyChartPizzaCustos() { if (chartPizzaCustosInstance) { chartPizzaCustosInstance.destroy(); chartPizzaCustosInstance = null; } }
export function renderizarGraficoPizzaCustos() { destroyChartPizzaCustos(); const canvas = document.getElementById('graficoPizzaCustosCanvas'); if (!canvas) return; const ctx = canvas.getContext('2d'); const elTotalMat = document.getElementById('resumoTotalMateriais'); const elTotalMO = document.getElementById('resumoTotalMO'); const custoTotalMateriais = elTotalMat ? parseCurrency(elTotalMat.textContent) : 0; const custoTotalMO = elTotalMO ? parseCurrency(elTotalMO.textContent) : 0; if (custoTotalMateriais === 0 && custoTotalMO === 0) { ctx.clearRect(0, 0, canvas.width, canvas.height); return; } chartPizzaCustosInstance = new Chart(ctx, { type: 'doughnut', data: { labels: ['Custo Total de Materiais', 'Custo Total de Mão de Obra'], datasets: [{ label: 'Distribuição de Custos', data: [custoTotalMateriais, custoTotalMO], backgroundColor: [ 'rgba(54, 162, 235, 0.7)', 'rgba(255, 159, 64, 0.7)' ], borderColor: [ 'rgba(54, 162, 235, 1)', 'rgba(255, 159, 64, 1)' ], borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top', }, title: { display: true, text: 'Distribuição de Custos (Material vs. M.O.)' }, tooltip: { callbacks: { label: function(context) { let label = context.label || ''; if (label) { label += ': '; } const value = context.parsed; const sum = context.dataset.data.reduce((a, b) => a + b, 0); const percentage = sum > 0 ? (value / sum * 100).toFixed(2) : 0; label += formatCurrency(value) + ` (${percentage}%)`; return label; } } } } } }); }