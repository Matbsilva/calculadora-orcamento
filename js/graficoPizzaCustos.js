// js/graficoPizzaCustos.js
// ... (Conteúdo completo do graficoPizzaCustos.js que forneci na penúltima mensagem)
import { formatCurrency, parseCurrency } from './utils.js';
let chartPizzaCustosInstance = null;
export function initGraficoPizzaCustos() { const canvas = document.getElementById('graficoPizzaCustosCanvas'); if (!canvas) { /* console.warn('Canvas Pizza não encontrado.'); */ return;} }
export function destroyChartPizzaCustos() { if (chartPizzaCustosInstance) { chartPizzaCustosInstance.destroy(); chartPizzaCustosInstance = null; } }
export function renderizarGraficoPizzaCustos(custoTotalMateriais, custoTotalMO) { destroyChartPizzaCustos(); const canvas = document.getElementById('graficoPizzaCustosCanvas'); if (!canvas) return; const ctx = canvas.getContext('2d'); if ((!custoTotalMateriais && !custoTotalMO) || (custoTotalMateriais === 0 && custoTotalMO === 0)) { ctx.clearRect(0, 0, canvas.width, canvas.height); /*ctx.fillText("Sem dados para exibir.", 10, 20);*/ return; } chartPizzaCustosInstance = new Chart(ctx, { type: 'doughnut', data: { labels: ['Custo Total de Materiais', 'Custo Total de Mão de Obra'], datasets: [{ label: 'Distribuição de Custos', data: [custoTotalMateriais, custoTotalMO], backgroundColor: [ 'rgba(54, 162, 235, 0.8)', 'rgba(255, 159, 64, 0.8)' ], borderColor: [ 'rgba(54, 162, 235, 1)', 'rgba(255, 159, 64, 1)' ], borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top', }, title: { display: true, text: 'Distribuição de Custos (Material vs. M.O.)', font: {size: 16} }, tooltip: { callbacks: { label: function(context) { let label = context.label || ''; if (label) { label += ': '; } const value = context.parsed; const sum = context.dataset.data.reduce((a, b) => a + b, 0); const percentage = sum > 0 ? (value / sum * 100).toFixed(2) : 0; label += formatCurrency(value) + ` (${percentage}%)`; return label; } } } } } }); }