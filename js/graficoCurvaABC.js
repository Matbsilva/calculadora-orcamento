// js/graficoCurvaABC.js
// ... (Conteúdo completo do graficoCurvaABC.js que forneci na penúltima mensagem)
import { formatCurrency, formatPercentage } from './utils.js';
let chartCurvaABCInstance = null;
export function initGraficoCurvaABC() { const canvas = document.getElementById('graficoCurvaABCCanvas'); if (!canvas) { /* console.warn('Canvas Curva ABC não encontrado.'); */ return;} }
export function destroyChartCurvaABC() { if (chartCurvaABCInstance) { chartCurvaABCInstance.destroy(); chartCurvaABCInstance = null; } }
export function renderizarGraficoCurvaABC(dadosCurvaABC) { destroyChartCurvaABC(); const canvas = document.getElementById('graficoCurvaABCCanvas'); if (!canvas || !dadosCurvaABC || dadosCurvaABC.length === 0) { if(canvas) { const ctx = canvas.getContext('2d'); ctx.clearRect(0, 0, canvas.width, canvas.height); /*ctx.fillText("Sem dados para exibir.", 10, 20);*/ } return; } const ctx = canvas.getContext('2d'); const labels = dadosCurvaABC.map(item => item.nome.length > 25 ? item.nome.substring(0,22)+'...' : item.nome); const custosIndividuais = dadosCurvaABC.map(item => item.custo); const percentuaisAcumulados = dadosCurvaABC.map(item => item.percentualAcumulado); chartCurvaABCInstance = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: [ { label: 'Custo Individual (R$)', data: custosIndividuais, backgroundColor: 'rgba(54, 162, 235, 0.7)', borderColor: 'rgba(54, 162, 235, 1)', yAxisID: 'yCusto', order: 2 }, { label: '% Acumulada', data: percentuaisAcumulados, type: 'line', borderColor: 'rgba(255, 99, 132, 1)', backgroundColor: 'rgba(255, 99, 132, 0.5)', fill: true, tension: 0.1, yAxisID: 'yPercentual', order: 1 } ] }, options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false, }, scales: { x: { ticks: { autoSkip: false, maxRotation: 65, minRotation: 35, font: {size: 10} } }, yCusto: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Custo (R$)' }, beginAtZero: true }, yPercentual: { type: 'linear', display: true, position: 'right', min: 0, max: 100, title: { display: true, text: '% Acumulada' }, ticks: { callback: function(value) { return value.toFixed(0) + "%"; } }, grid: { drawOnChartArea: false, }, } }, plugins: { tooltip: { callbacks: { label: function(context) { let label = context.dataset.label || ''; if (label) { label += ': '; } if (context.dataset.yAxisID === 'yCusto' && context.parsed.y !== null) { label += formatCurrency(context.parsed.y); } if (context.dataset.yAxisID === 'yPercentual' && context.parsed.y !== null) { label += formatPercentage(context.parsed.y, 2); } return label; } } }, legend: { position: 'top', }, title: { display: true, text: 'Curva ABC de Custos de Serviços/Composições', font: {size: 16} } } } }); }